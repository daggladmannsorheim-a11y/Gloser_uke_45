<!doctype html>
<html lang="nb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Uke 45 · Snake – Gloser (6. trinn, Kampen skole)</title>
<style>
  :root{
    --bg:#0f1320; --panel:#151a2b; --ink:#eef3fb; --muted:#9fb1d1; --acc:#6ee7a2; --bad:#ff6b6b; --warn:#ffd166;
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b1020,#0f1320);}
  body{color:var(--ink);font:16px system-ui,Segoe UI,Roboto,Helvetica,Arial}
  header{padding:12px 14px;background:rgba(21,26,43,.8);position:sticky;top:0;border-bottom:1px solid #1f2a44}
  h1{margin:0;font-size:18px;letter-spacing:.2px}
  #sub{font-size:13px;color:var(--muted)}
  .wrap{max-width:980px;margin:10px auto;padding:8px}
  .grid{display:grid;grid-template-columns:1fr 330px;gap:14px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  #canvasWrap{background:radial-gradient(ellipse at 30% -10%,#1a2240,#0f1320 60%);border:1px solid #223057;border-radius:10px;padding:10px}
  canvas{display:block;background:#0b1020;margin:auto;border-radius:8px;border:1px solid #1e2a4a}
  #ui{background:var(--panel);border:1px solid #1f2a44;border-radius:10px;padding:12px}
  #prompt{font-weight:700;margin:6px 0 8px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0}
  button,select,input[type=range]{appearance:none;background:#1b2543;color:var(--ink);border:1px solid #223057;padding:8px 10px;border-radius:8px;font-weight:600}
  button:hover{filter:brightness(1.15)} button:active{transform:translateY(1px)}
  .btn-prim{background:#1e3a2f;border-color:#1b5a3d} .good{color:var(--acc)} .bad{color:var(--bad)}
  .pill{display:inline-block;padding:3px 8px;background:#1b2543;border:1px solid #2a3a68;border-radius:999px;font-size:12px;color:var(--muted)}
  #legend{font-size:13px;color:var(--muted);line-height:1.35}
  #mob{display:grid;grid-template-columns:64px 64px 64px;gap:10px;justify-content:center;margin-top:10px}
  #mob button{width:64px;height:64px;font-size:18px}
  #mob .ghost{visibility:hidden}
  .stat{font-weight:700}
  .chip{display:inline-flex;align-items:center;gap:6px;background:#1b2543;border:1px solid #2a3a68;border-radius:999px;padding:4px 10px}
</style>
</head>
<body>
<header>
  <h1>Snake – Gloser • Uke 45 <span id="week" class="pill">6. trinn · Kampen skole</span></h1>
  <div id="sub">Styr slangen til riktig norsk oversettelse. Feil «mat» = liv mistes. Piler/WASD på tastatur eller knappene under.</div>
</header>

<div class="wrap grid">
  <div id="canvasWrap">
    <canvas id="game" width="720" height="480" aria-label="Snake-spill"></canvas>
  </div>

  <aside id="ui">
    <div id="prompt">Finn norsk for: <span id="english" class="stat"></span></div>

    <div class="row">
      <span class="chip">Poeng: <span id="score">0</span></span>
      <span class="chip">Runder: <span id="round">0</span>/10</span>
      <span class="chip">Liv: <span id="lives">❤❤❤</span></span>
      <span class="chip">Fart: <span id="speedShow">7</span></span>
    </div>

    <div class="row">
      <button id="start" class="btn-prim">Start / Restart</button>
      <button id="pause">Pause</button>
      <label class="pill">Fart <input id="speed" type="range" min="4" max="16" value="7"></label>
    </div>

    <div id="legend">
      <p>Oppgave: Styr slangen til <span class="good">riktig norsk</span>. De andre ordene er lokkemat (<span class="bad">feil</span>).</p>
      <p>Kontroller: Piltaster/WASD. Ikke snu 180° i samme tick.</p>
      <p>Tips: Farten kan justeres mellom runder. Lagret toppscore i denne nettleseren.</p>
      <p>Topp: <span id="best" class="stat">0</span></p>
    </div>

    <div id="mob">
      <span class="ghost"></span>
      <button id="up">⬆️</button>
      <span class="ghost"></span>
      <button id="left">⬅️</button>
      <button id="down">⬇️</button>
      <button id="right">➡️</button>
    </div>
  </aside>
</div>

<script>
/* ====== Data: uke 45 gloser ====== */
const PAIRS = [
  {en:"Decent", no:"ordentlig"},
  {en:"Grin", no:"smil"},
  {en:"Terrified", no:"veldig redd"},
  {en:"Wailed", no:"gråt"},
  {en:"Yelping", no:"bjeffende"},
  {en:"Leer", no:"sultent blikk"},
  {en:"Furry coat", no:"pelskåpe"},
  {en:"Flickers", no:"blunker i rykninger"},
  {en:"Whips out", no:"trekker frem"},
  {en:"Knickers", no:"underbukser"}
];

/* ====== Helpers ====== */
const rand = (n)=>Math.floor(Math.random()*n);
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=rand(i+1); [a[i],a[j]]=[a[j],a[i]];} return a}
const LS_KEY = "snake_gloser_uke45_best";

/* ====== Game State ====== */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const ui = {
  english: document.getElementById('english'),
  score: document.getElementById('score'),
  round: document.getElementById('round'),
  lives: document.getElementById('lives'),
  speed: document.getElementById('speed'),
  speedShow: document.getElementById('speedShow'),
  best: document.getElementById('best'),
  start: document.getElementById('start'),
  pause: document.getElementById('pause'),
  mobUp: document.getElementById('up'),
  mobDown: document.getElementById('down'),
  mobLeft: document.getElementById('left'),
  mobRight: document.getElementById('right'),
};
ui.best.textContent = localStorage.getItem(LS_KEY)||0;

const grid = 24;           // px per cell
const cols = Math.floor(canvas.width / grid);
const rows = Math.floor(canvas.height / grid);

let loopId = null, paused=false;
let speedMs = 1000/Number(ui.speed.value); // ticks per second based on slider
let lastTick = 0;

let snake, dir, nextDir, targets, currentIdx, score, lives, round, used;

/* ====== Targets (mat + lokkemat) ====== */
function newRound(){
  round++;
  ui.round.textContent = Math.min(round,10);
  // pick an unused pair
  if(used.length===PAIRS.length) used = [];
  const remaining = PAIRS.filter(p=>!used.includes(p.en));
  const pick = remaining[rand(remaining.length)];
  used.push(pick.en);
  ui.english.textContent = pick.en;

  // build 3 labels (1 correct + 2 wrong)
  const wrongs = shuffle(PAIRS.filter(p=>p.en!==pick.en)).slice(0,2).map(p=>p.no);
  const labels = shuffle([pick.no, ...wrongs]);

  // place them at random cells
  targets = labels.map((label,i)=>({
    label,
    correct: label===pick.no,
    pos: freeCell()
  }));
}

/* ====== Snake init ====== */
function reset(){
  snake = [{x:Math.floor(cols/2), y:Math.floor(rows/2)}];
  dir = {x:1,y:0}; nextDir = {x:1,y:0};
  score = 0; lives = 3; round = 0; used=[];
  ui.score.textContent = score;
  ui.lives.textContent = "❤".repeat(lives);
  newRound();
}

/* ====== Board helpers ====== */
function cellOccupied(x,y){
  return snake.some(s=>s.x===x&&s.y===y) ||
         targets.some(t=>t.pos.x===x&&t.pos.y===y);
}
function freeCell(){
  let x,y,tries=0;
  do{
    x = rand(cols);
    y = rand(rows);
    tries++;
    if(tries>500) break;
  } while(cellOccupied(x,y));
  return {x,y};
}

/* ====== Drawing ====== */
function draw(){
  // background grid
  ctx.fillStyle = "#0b1020";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle = "#172247";
  ctx.lineWidth = 1;
  for(let i=0;i<=cols;i++){ ctx.beginPath(); ctx.moveTo(i*grid,0); ctx.lineTo(i*grid,canvas.height); ctx.stroke(); }
  for(let j=0;j<=rows;j++){ ctx.beginPath(); ctx.moveTo(0,j*grid); ctx.lineTo(canvas.width,j*grid); ctx.stroke(); }

  // targets
  targets.forEach(t=>{
    const x=t.pos.x*grid, y=t.pos.y*grid;
    ctx.fillStyle = t.correct ? "rgba(110,231,162,.25)" : "rgba(255,107,107,.18)";
    ctx.fillRect(x+1,y+1,grid-2,grid-2);
    ctx.fillStyle = "#eaf2ff";
    ctx.font = "12px system-ui, Segoe UI, Roboto";
    ctx.textAlign="center"; ctx.textBaseline="middle";
    wrapText(t.label, x+grid/2, y+grid/2, grid-4, 12);
  });

  // snake
  ctx.fillStyle="#79c8ff";
  snake.forEach((s,i)=>{
    const x=s.x*grid, y=s.y*grid;
    ctx.fillRect(x+2,y+2,grid-4,grid-4);
    if(i===0){ // eyes
      ctx.fillStyle="#0b1020";
      ctx.fillRect(x+6,y+8,3,3);
      ctx.fillRect(x+grid-9,y+8,3,3);
      ctx.fillStyle="#79c8ff";
    }
  });
}

// helper to draw wrapped text within a cell
function wrapText(text,cx,cy,maxWidth,lineHeight){
  const words = text.split(' ');
  let line="", lines=[];
  for(let w of words){
    const test = line? line+" "+w : w;
    if(ctx.measureText(test).width <= maxWidth) line=test;
    else{ lines.push(line); line=w; }
  }
  if(line) lines.push(line);
  const startY = cy - (lines.length-1)*lineHeight/2;
  lines.forEach((ln,i)=> ctx.fillText(ln, cx, startY+i*lineHeight) );
}

/* ====== Game Loop ====== */
function tick(timestamp){
  if(paused){ draw(); loopId = requestAnimationFrame(tick); return; }
  if(timestamp - lastTick < speedMs){ loopId = requestAnimationFrame(tick); return; }
  lastTick = timestamp;

  // advance dir
  if( (nextDir.x !== -dir.x) || (nextDir.y !== -dir.y) ) dir = nextDir;

  // next head
  const head = {...snake[0]};
  head.x += dir.x; head.y += dir.y;

  // wall collision -> lose life
  if(head.x<0||head.y<0||head.x>=cols||head.y>=rows){
    loseLife("Veggen!");
    return loopId = requestAnimationFrame(tick);
  }
  // self collision
  if(snake.some(p=>p.x===head.x && p.y===head.y)){
    loseLife("Traff halen!");
    return loopId = requestAnimationFrame(tick);
  }

  snake.unshift(head);

  // target check
  let ate = targets.find(t=>t.pos.x===head.x && t.pos.y===head.y);
  if(ate){
    if(ate.correct){
      score += 10; ui.score.textContent = score;
      // grow (do not pop tail) and new round
      newRound();
      ping("riktig");
    }else{
      // wrong -> shrink & life--
      snake.pop(); // neutralize growth
      loseLife("Feil ord");
    }
  }else{
    snake.pop(); // normal move
  }

  draw();
  loopId = requestAnimationFrame(tick);
}

function loseLife(reason){
  lives--; ui.lives.textContent = "❤".repeat(Math.max(lives,0));
  flash(reason, "bad");
  if(lives<=0){ gameOver(); }
  else{
    // reposition snake to center and keep targets
    snake = [{x:Math.floor(cols/2), y:Math.floor(rows/2)}];
    dir = {x:1,y:0}; nextDir={x:1,y:0};
  }
}

function gameOver(){
  paused=true;
  const best = Number(localStorage.getItem(LS_KEY)||0);
  if(score>best){ localStorage.setItem(LS_KEY, String(score)); ui.best.textContent = score; }
  flash("Game over! Poeng: "+score, "bad", 1600);
}

function flash(msg, cls="good", t=900){
  const bar = document.createElement('div');
  bar.textContent = msg;
  bar.style.position="fixed"; bar.style.left="50%"; bar.style.top="12px";
  bar.style.transform="translateX(-50%)";
  bar.style.background= cls==="good"?"#1f503a":"#5b2230";
  bar.style.color="#fff"; bar.style.padding="10px 14px"; bar.style.borderRadius="10px";
  bar.style.border="1px solid rgba(255,255,255,.15)";
  bar.style.zIndex=9999; document.body.appendChild(bar);
  setTimeout(()=>bar.remove(), t);
}
function ping(type){ flash("Riktig! +10", "good"); }

/* ====== Controls ====== */
function setDir(dx,dy){
  // prevent immediate 180° (handled also in loop)
  if(dx===-dir.x && dy===-dir.y) return;
  nextDir = {x:dx,y:dy};
}
window.addEventListener('keydown',e=>{
  const k=e.key.toLowerCase();
  if(["arrowup","w"].includes(k)) setDir(0,-1);
  else if(["arrowdown","s"].includes(k)) setDir(0,1);
  else if(["arrowleft","a"].includes(k)) setDir(-1,0);
  else if(["arrowright","d"].includes(k)) setDir(1,0);
});
ui.mobUp.onclick = ()=>setDir(0,-1);
ui.mobDown.onclick = ()=>setDir(0,1);
ui.mobLeft.onclick = ()=>setDir(-1,0);
ui.mobRight.onclick = ()=>setDir(1,0);

ui.speed.addEventListener('input',()=>{
  ui.speedShow.textContent = ui.speed.value;
  speedMs = 1000/Number(ui.speed.value);
});
ui.start.onclick = ()=>{
  paused=false; reset(); cancelAnimationFrame(loopId); lastTick=0; loopId=requestAnimationFrame(tick);
};
ui.pause.onclick = ()=>{
  paused=!paused;
  ui.pause.textContent = paused? "Fortsett":"Pause";
};

/* ====== Boot ====== */
reset(); draw(); // show board before start
</script>
</body>
</html>
